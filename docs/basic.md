# Querydsl의 장점

1. 컴파일 시점에 오류를 발견할 수 있다.
2. 파라미터 바인딩을 자동으로 해결해준다.
   - 파라미터 여러개를 where 안에 넘기면 AND 조건이다.
   - where절 중간에 null이 들어가면 무시하기 때문에 **동적 쿼리를 만들 때 유용하다.**

# 기본 Q-Type 활용

### Q-Type을 활용하는 방법

1. 별칭 활용
2. Q-Type 클래스를 static import해서 활용한다. - 권장하는 방법

# 검색 조건 쿼리

where 절 안에 콤마(,)로 구분해서 조건을 넣으면 AND 조건으로 처리된다.

- 중간에 null은 무시하기 때문에 동적 쿼리를 만들 때 유용하다.

# 결과 조회

- `fetch()` : 리스트 조회, 데이터 없으면 빈 리스트 반환
- `fetchOne()` : 단 건 조회
    - 결과가 없으면 null
    - 결과가 둘 이상이면 com.querydsl.core.NonUniqueResultException
- `fetchFirst()` : limit(1).fetchOne()
- `fetchResults()` : 페이징 정보 포함, total count 쿼리 추가 실행
- `fetchCount()` : count 쿼리로 변경해서 count 수 조회 - Deprecated

# 조인 - 기본 조인

### 기본 조인

- 조인의 기본 문법은 첫 번째 파라미터에 조인 대상을 지정하고, 두 번째 파라미터에 별칭(alias)으로 사용할 Q 타입을 지정하는 것이다.

### 세타 조인

- 연관 관계가 없는 필드로 조인
- from 절에 여러 엔티티를 선택해서 세타 조인
- 외부 조인 불가능 → 다음에 설명할 조인 on을 사용하면 외부 조인 가능

# 조인 - on절

- ON절을 활용한 조인
    - 조인 대상 필터링
    - 연관 관계 없는 엔티티 외부 조인

### 조인 대상 필터링

> 참고 : on 절을 활용해 조인 대상을 필터링 할 때, 외부 조인이 아니라 내부 조인(inner join)을 사용하면, where 절에서 필터링하는 것과 기능이 동일하다.

따라서 on 절을 활용한 조인 대상 필터링을 사용할 때, 내부 조인이면 익숙한 where 절로 해결하고, 정말 외부 조인이 필요한 경우에만 on절을 사용하자.
>

### 연관 관계 없는 엔티티 외부 조인

- 하이버네이트 5.1부터 on을 사용해서 서로 관계가 없는 필드로 외부 조인하는 기능이 추가되었다. 물론 내부 조인도 가능하다.
- 주의! 문법을 잘 봐야 한다. leftJoin() 부분에 일반 조인과 다르게 엔티티 하나만 들어간다.
    - 일반 조인 : `leftJoint(member.team, team)`
    - on조인 : `from(member).leftJoin(team).on(xxx)`

# 조인 - 페치 조인

- 페치 조인은 SQL에서 제공하는 기능은 아니다. SQL 조인을 활용해서 연관된 엔티티를 SQL 한번에 조회하는 기능이다. 주로 성능 최적화에 사용하는 방법이다.

# 서브쿼리

- `com.querydsl.jpa.JPAExpressins` 사용

> FROM 절의 서브쿼리 한계

JPA JPQL 서브쿼리의 한계점으로 from 절의 서브쿼리(인라인 뷰)는 지원하지 않는다.
당연히 Querydsl도 지원하지 않는다. 하이버네이트 구현체를 사용하면 select 절의 서브쿼리는 지원한다. Querydsl도 하이버네이트 구현체를 사용하면 select 절의 서브쿼리를 지원한다.
>

### from 절의 서브쿼리 해결방안

1. 서브쿼리를 join으로 변경한다. (가능한 상황도 있고, 불가능한 상황도 있다.)
2. 애플리케이션에서 쿼리를 2번 분리해서 사용한다.
3. nativeSQL을 사용한다.

# Case 문

- SELECT, 조건절(WHERE)에서 사용 가능

# 상수, 문자 더하기

- 상수가 필요하면 `Expressions.constant(xxx)` 사용

### 문자 더하기 concat

> 참고 : member.age.stringValue() 부분이 중요한데, 문자가 아닌 다른 타입들은 stringValue() 로 문자 변환이 가능하다. 이 방법은 ENUM을 처리할 때도 자주 사용한다.
>